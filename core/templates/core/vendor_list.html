{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<style>
    .card {
        border: none;
        box-shadow: 0 0.5rem 1rem rgba(177, 140, 140, 0.15);
        margin-bottom: 1.5rem;
        border-radius: 0.75rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: none;
        padding: 1.5rem;
        border-radius: 0.75rem 0.75rem 0 0;
    }
    .card-body {
        padding: 1.5rem;
    }
    .table th {
        background-color: #007bff;
        color: white;
        border: none;
    }
    .table td {
        border-top: none;
    }
    .table-hover tbody tr:hover {
        background-color: #f1f8ff;
    }
    .vendor-name {
        color: #141516;
        text-decoration: none;
    }
    .vendor-name:hover {
        text-decoration: underline;
    }
    .badge-relationship {
        font-size: 0.85rem;
    }
</style>
{% endblock %}

{% block content %}
<h1 class="mb-4">Vendor List</h1>

<div class="card mb-4">
    <div class="card-header">
        <h5 class="card-title mb-0">Search and Filter</h5>
    </div>
    <div class="card-body">
        <form method="get" id="searchForm" class="row g-3">
            <div class="col-md-4">
                <input type="text" name="search" class="form-control" placeholder="Search vendors..." value="{{ search_query }}" oninput="submitForm()">
            </div>
            <div class="col-md-3">
                <select name="relationship_type" class="form-select" onchange="submitForm()">
                    <option value="">All Relationship Types</option>
                    {% for choice in vendor_relationship_types %}
                    <option value="{{ choice.0 }}" {% if choice.0 == relationship_type %} selected{% endif %}>{{ choice.1 }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <select name="risk_level" class="form-select" onchange="submitForm()">
                    <option value="">All Risk Levels</option>
                    {% for choice in risk_levels %}
                    <option value="{{ choice.0 }}" {% if choice.0 == risk_level %} selected{% endif %}>{{ choice.1 }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <button class="btn btn-secondary w-100" type="button" onclick="resetSearch()">Reset</button>
            </div>
        </form>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Vendor Name</th>
                        <th>Vendor ID</th>
                        <th>Payment Terms</th>
                        <th>Contract Year</th>
                        <th>Relationship Type</th>
                    </tr>
                </thead>
                <tbody>
                    {% for vendor in vendors %}
                    <tr>
                        <td><a href="{% url 'vendor_profile' vendor.pk %}" class="vendor-name">{{ vendor.vendor_name }}</a></td>
                        <td>{{ vendor.vendor_id }}</td>
                        <td>{{ vendor.payment_terms }}</td>
                        <td>{{ vendor.contract_year }}</td>
                        <td>
                            <span class="badge bg-{% if vendor.relationship_type == 'DIRECT' %}primary{% else %}secondary{% endif %} badge-relationship">
                                {{ vendor.get_relationship_type_display }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% include 'core/pagination.html' %}

<script>
    function submitForm() {
        document.getElementById('searchForm').submit();
    }
    
    function resetSearch() {
        document.getElementsByName('search')[0].value = '';
        document.getElementsByName('relationship_type')[0].selectedIndex = 0;
        document.getElementsByName('risk_level')[0].selectedIndex = 0;
        submitForm();
    }
</script>
{% endblock %}
